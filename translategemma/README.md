# TranslateGemma 支持语言与使用

支持语言（WMT24++ 55 种）

语言代码参考 ISO 639-1：https://en.wikipedia.org/wiki/ISO_639-1  
TranslateGemma 论文表 1：https://aclanthology.org/2025.findings-acl.634.pdf

<table>
  <thead>
    <tr>
      <th>代码</th>
      <th>语言</th>
      <th>地区</th>
      <th>类别</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>cs_CZ</td><td>捷克语</td><td>捷克</td><td>WMT24 原有</td></tr>
    <tr><td>de_DE</td><td>德语</td><td>德国</td><td>WMT24 原有</td></tr>
    <tr><td>es_MX</td><td>西班牙语</td><td>墨西哥</td><td>WMT24 原有</td></tr>
    <tr><td>hi_IN</td><td>印地语</td><td>印度</td><td>WMT24 原有</td></tr>
    <tr><td>ja_JP</td><td>日语</td><td>日本</td><td>WMT24 原有</td></tr>
    <tr><td>ru_RU</td><td>俄语</td><td>俄罗斯</td><td>WMT24 原有</td></tr>
    <tr><td>uk_UA</td><td>乌克兰语</td><td>乌克兰</td><td>WMT24 原有</td></tr>
    <tr><td>zh_CN</td><td>中文（普通话）</td><td>中国</td><td>WMT24 原有</td></tr>
    <tr><td>ar_EG</td><td>阿拉伯语</td><td>埃及</td><td>新增</td></tr>
    <tr><td>ar_SA</td><td>阿拉伯语</td><td>沙特</td><td>新增</td></tr>
    <tr><td>bg_BG</td><td>保加利亚语</td><td>保加利亚</td><td>新增</td></tr>
    <tr><td>bn_IN</td><td>孟加拉语</td><td>印度</td><td>新增</td></tr>
    <tr><td>ca_ES</td><td>加泰罗尼亚语</td><td>西班牙</td><td>新增</td></tr>
    <tr><td>da_DK</td><td>丹麦语</td><td>丹麦</td><td>新增</td></tr>
    <tr><td>el_GR</td><td>希腊语</td><td>希腊</td><td>新增</td></tr>
    <tr><td>et_EE</td><td>爱沙尼亚语</td><td>爱沙尼亚</td><td>新增</td></tr>
    <tr><td>fa_IR</td><td>波斯语</td><td>伊朗</td><td>新增</td></tr>
    <tr><td>fi_FI</td><td>芬兰语</td><td>芬兰</td><td>新增</td></tr>
    <tr><td>fil_PH</td><td>菲律宾语</td><td>菲律宾</td><td>新增</td></tr>
    <tr><td>fr_CA</td><td>法语</td><td>加拿大</td><td>新增</td></tr>
    <tr><td>fr_FR</td><td>法语</td><td>法国</td><td>新增</td></tr>
    <tr><td>gu_IN</td><td>古吉拉特语</td><td>印度</td><td>新增</td></tr>
    <tr><td>he_IL</td><td>希伯来语</td><td>以色列</td><td>新增</td></tr>
    <tr><td>hr_HR</td><td>克罗地亚语</td><td>克罗地亚</td><td>新增</td></tr>
    <tr><td>hu_HU</td><td>匈牙利语</td><td>匈牙利</td><td>新增</td></tr>
    <tr><td>id_ID</td><td>印度尼西亚语</td><td>印度尼西亚</td><td>新增</td></tr>
    <tr><td>it_IT</td><td>意大利语</td><td>意大利</td><td>新增</td></tr>
    <tr><td>kn_IN</td><td>卡纳达语</td><td>印度</td><td>新增</td></tr>
    <tr><td>ko_KR</td><td>韩语</td><td>韩国</td><td>新增</td></tr>
    <tr><td>lt_LT</td><td>立陶宛语</td><td>立陶宛</td><td>新增</td></tr>
    <tr><td>lv_LV</td><td>拉脱维亚语</td><td>拉脱维亚</td><td>新增</td></tr>
    <tr><td>ml_IN</td><td>马拉雅拉姆语</td><td>印度</td><td>新增</td></tr>
    <tr><td>mr_IN</td><td>马拉地语</td><td>印度</td><td>新增</td></tr>
    <tr><td>nl_NL</td><td>荷兰语</td><td>荷兰</td><td>新增</td></tr>
    <tr><td>no_NO</td><td>挪威语</td><td>挪威</td><td>新增</td></tr>
    <tr><td>pa_IN</td><td>旁遮普语</td><td>印度</td><td>新增</td></tr>
    <tr><td>pl_PL</td><td>波兰语</td><td>波兰</td><td>新增</td></tr>
    <tr><td>pt_BR</td><td>葡萄牙语</td><td>巴西</td><td>新增</td></tr>
    <tr><td>pt_PT</td><td>葡萄牙语</td><td>葡萄牙</td><td>新增</td></tr>
    <tr><td>ro_RO</td><td>罗马尼亚语</td><td>罗马尼亚</td><td>新增</td></tr>
    <tr><td>sk_SK</td><td>斯洛伐克语</td><td>斯洛伐克</td><td>新增</td></tr>
    <tr><td>sl_SI</td><td>斯洛文尼亚语</td><td>斯洛文尼亚</td><td>新增</td></tr>
    <tr><td>sr_RS</td><td>塞尔维亚语</td><td>塞尔维亚</td><td>新增</td></tr>
    <tr><td>sv_SE</td><td>瑞典语</td><td>瑞典</td><td>新增</td></tr>
    <tr><td>sw_KE</td><td>斯瓦希里语</td><td>肯尼亚</td><td>新增</td></tr>
    <tr><td>sw_TZ</td><td>斯瓦希里语</td><td>坦桑尼亚</td><td>新增</td></tr>
    <tr><td>ta_IN</td><td>泰米尔语</td><td>印度</td><td>新增</td></tr>
    <tr><td>te_IN</td><td>泰卢固语</td><td>印度</td><td>新增</td></tr>
    <tr><td>th_TH</td><td>泰语</td><td>泰国</td><td>新增</td></tr>
    <tr><td>tr_TR</td><td>土耳其语</td><td>土耳其</td><td>新增</td></tr>
    <tr><td>ur_PK</td><td>乌尔都语</td><td>巴基斯坦</td><td>新增</td></tr>
    <tr><td>vi_VN</td><td>越南语</td><td>越南</td><td>新增</td></tr>
    <tr><td>zh_TW</td><td>中文（普通话）</td><td>台湾</td><td>新增</td></tr>
    <tr><td>zu_ZA</td><td>祖鲁语</td><td>南非</td><td>新增</td></tr>
  </tbody>
</table>

注：论文另提及 WMT24 的冰岛语，但未给出代码。

官方信息（TranslateGemma / Ollama）

- 官方页面（模型介绍、Prompt 格式、支持语言列表）：见 TranslateGemma 模型页。citeturn0search0
- 模型元数据中的 `gemma3.context_length` 为 131072（Ollama 元数据），但这只是**模型标称上下文上限**，实际能否在 vLLM 中使用取决于 `max_model_len` 与显存。citeturn0search1turn0search6
- vLLM 的 `max_model_len` 是“输入+输出”的上下文上限参数，未指定时会基于模型配置自动推导。citeturn0search6

建议：在 24G 单卡上不要直接把 `max_model_len` 设置到 131072，而是以你当前 vLLM 启动日志或 `max_model_len` 配置为准，逐步调高并观察显存与稳定性。

部署与使用（简化）

1. 启动服务

   ```bash
   docker compose build translategemma
   docker compose up -d translategemma
   ```

2. 简单 curl 示例

   ```bash
   curl -X POST "http://localhost:8020/v1/chat/completions" \
     -H "Authorization: Bearer sgl-R5tG8uI7vW9xY0zAbC2dE4fG6hJ8kL9m" \
     -H "Content-Type: application/json" \
     --data '{
       "model": "translategemma",
       "messages": [
         {
           "role": "user",
           "content": [
             {
               "type": "text",
               "source_lang_code": "en",
               "target_lang_code": "it",
               "text": "Hello, world."
             }
           ]
         }
       ]
     }'
   ```

3. Markdown 翻译（推荐）

   ```bash
   export VLLM_API_KEY=sgl-R5tG8uI7vW9xY0zAbC2dE4fG6hJ8kL9m
   python translate_markdown.py -i README.md -o README.zh.md --source-lang en --target-lang zh
   ```

   说明：
   - 必须指定 `--source-lang`
   - 代码块/行内代码/HTML/LaTeX/图片标签会被保护
   - 标题/列表/表格结构保持不变
   - 可用 `--max-chars` 合并段落、`--max-tokens` 限制输出

**translate_markdown.py 实现要点**

- **分段与合并**：按段落/标题/列表合并文本，支持 `--max-chars` 自动推导，避免超出模型上下文。
- **表格策略（Cell-only）**：HTML/Markdown 表格只做单元格翻译，避免结构破坏；即使传 `--table-batch-mode` 也会强制为 `cell`。
- **格式保护**：Markdown/HTML/LaTeX/代码块/链接/图片等内容先保护占位，翻译后还原，确保结构不变。
- **提示词模板**：使用 `prompt_templates/translate_gemma_12b.txt` 渲染；可用 `--custom-system-prompt` 增加自定义指令。
- **风格控制**：支持 `--style-mode auto|fixed|off`；`auto` 会抽取样本判断风格并加入风格指令。
- **缓存**：支持持久化缓存（SQLite），命中时直接返回，避免重复请求。

4. 图片翻译（说明）

   图片翻译会将图片中的文字翻译为目标语言，输出仅包含文本，不会生成图片。

5. 纯 pipeline 版本（不依赖 vLLM）

   ```bash
   python translate_markdown_pipeline.py -i README.md -o README.zh.md --source-lang en --target-lang zh
   ```
